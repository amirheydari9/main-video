var mayPlayerWrapper=document.getElementsByClassName("myplayer")[0],lastVal;const controlsHtml='\n    <div class="controls__progressbar">\n        <input class="controls__progressbar-current" type="range" min="1" max="100" step="1" value="0" />\n        <div class="seek-tooltip" id="seek-tooltip">00:00</div>\n    </div>\n    <div class="controls__btns">\n        <div class="left">\n            <div class="btns play">\n                <img src="./img/play.svg" alt=""/>\n            </div>\n            <div class="pause">\n                <img src="./img/pause.svg" alt=""/>\n            </div>\n            <div class="btns rewind">\n                <img src="./img/rewind.svg" alt=""/>\n            </div>\n            <div class="btns forward">\n                <img src="./img/fast-forward.svg" alt=""/>\n            </div>\n            <div class="btns volume">\n                <img src="./img/volume.svg" alt="" class="volume_icon ">\n                <img src="./img/mute1.svg" alt="" class=" mute">\n                <div class="volume__progress ml-2">\n                    <input id="volume_bar" type="range" min="1" max="100" step="1" value = "50" />\n                </div>\n            </div>\n            <div class="timer">\n                <span class="currentTime">00:00</span>\n                <span class="time_divider">/</span>\n                <span class="videoTime" >00:00</span>\n            </div>\n        </div>\n        <div class="right">\n            <div class=" btns pic">\n                <img src="./img/Pic_in_pic.svg" alt=""/>\n            </div>\n            <div class="btns setting">\n                <img src="./img/Setting.svg" alt=""/>\n            </div>\n            <div class="btns theater">\n                <img src="./img/Wide.svg" alt=""/>\n            </div>\n            <div class="btns fullscreen">\n                <img class="icon" src="./img/Fullscreen.svg" alt=""/>\n            </div>\n        </div>\n        <ul class="speed">\n            <li class="speed_rate_item">2X</li>\n            <li class="speed_rate_item">1.5X</li>\n            <li class="active speed_rate_item">1X</li>\n            <li class="speed_rate_item">0.5X</li>\n        </ul>\n    </div>';let controlWrapper=document.createElement("div");controlWrapper.innerHTML=controlsHtml,controlWrapper.classList.add("myplayer__controls"),mayPlayerWrapper.appendChild(controlWrapper);var controls=mayPlayerWrapper.querySelector(".myplayer__controls"),media=mayPlayerWrapper.querySelector("video"),play=controls.querySelector(".play"),pause=controls.querySelector(".pause"),rwd=controls.querySelector(".rewind"),fwd=controls.querySelector(".forward"),timer=controls.querySelector(".timer"),current_time=timer.querySelector(".currentTime"),video_time=timer.querySelector(".videoTime"),time_divider=timer.querySelector(".time_divider"),input=controls.querySelector(".controls__progressbar-current"),volume=controls.querySelector(".volume"),volume_icon=volume.querySelector(".volume_icon"),mute_icon=volume.querySelector(".mute"),volume_progress=volume.querySelector(".volume__progress"),input_volume=volume_progress.querySelector("input"),fullscreen_icon=controls.querySelector(".fullscreen .icon"),setting=mayPlayerWrapper.querySelector(".setting"),controls__progressbar=mayPlayerWrapper.querySelector(".controls__progressbar"),progress_input=controls__progressbar.querySelector("input"),seek_tooltip=mayPlayerWrapper.querySelector(".seek-tooltip"),progressColor="rgba(255, 186, 0, 1)";media.addEventListener("loadedmetadata",function(){video_time.textContent=gettime(media.duration)}),input.addEventListener("input",function(){media.currentTime=this.value/100*media.duration}),seek_tooltip.style.display="none";let animatedBtn=document.createElement("div");function playanimation(){media.play(),pause.style.display="flex",play.style.display="none",animatedBtn.classList.remove("animationsTow"),animatedBtn.classList.toggle("animations"),animatedBtn.innerHTML="",animatedBtn.innerHTML='<img src="./img/play.svg" alt="play">'}function pauseanimation(){media.pause(),pause.style.display="none",play.style.display="flex",animatedBtn.classList.toggle("animations"),animatedBtn.classList.add("animationsTow"),animatedBtn.innerHTML="",animatedBtn.innerHTML='<img src="./img/pause.svg" alt="pause">'}function progressRange(){current_time.textContent=gettime(media.currentTime);let e=media.currentTime/media.duration*100;input.style.background=`linear-gradient(90deg, ${progressColor} ${e}%, #000000E6 0%)`}animatedBtn.classList.add("animated_btns"),media.insertAdjacentElement("afterend",animatedBtn),animatedBtn.innerHTML='<img src="./img/play.svg" alt="play">',animatedBtn.addEventListener("click",function(){animatedBtn.classList.contains("animations")?(pauseanimation(),animatedBtn.style.display="flex"):(video_time.textContent=gettime(media.duration),playanimation(),animatedBtn.style.display="flex")}),media.addEventListener("click",function(){media.paused?(playanimation(),animatedBtn.style.display="flex"):(pauseanimation(),animatedBtn.style.display="flex")}),play.addEventListener("click",function(){media.paused?(playanimation(),animatedBtn.style.display="flex"):(media.pause(),play.style.display="flex",pause.style.display="none")}),pause.addEventListener("click",function(){media.played?(pauseanimation(),animatedBtn.style.display="flex"):(media.play(),pause.style.display="flex",play.style.display="none")}),media.addEventListener("timeupdate",progressRange),rwd.addEventListener("click",function(){media.currentTime=media.currentTime-10}),fwd.addEventListener("click",function(){media.currentTime=media.currentTime+10}),input_volume.addEventListener("input",function(){mute_icon.style.display="none",volume_icon.style.display="flex",input_volume.setAttribute("value",`${this.value}`),media.volume=this.value/100,input_volume.style.background=`linear-gradient(90deg,${progressColor} ${this.value}%, #FFFFFF33 0%)`}),volume_icon.addEventListener("click",function(){input_volume.classList.toggle("fadeInLeft"),input_volume.style.display="none",mute_icon.style.display="flex",volume_icon.style.display="none",input_volume.style.background=`linear-gradient(90deg, ${progressColor} 1% , rgba(255, 255, 255, 0.2) 0%)`,lastVal=input_volume.getAttribute("value"),input_volume.setAttribute("value","0"),media.volume=0}),mute_icon.addEventListener("click",function(){input_volume.style.display="flex",volume_icon.style.display="flex",mute_icon.style.display="none",input_volume.style.background=`linear-gradient(90deg, ${progressColor}  ${lastVal}% , #FFFFFF33 0%)`,input_volume.setAttribute("value",`${lastVal}`),media.volume=lastVal/100});let video_theater=document.querySelector("#video-threater"),default_palyer=document.querySelector("#default-palyer"),theater=mayPlayerWrapper.querySelector(".theater"),toggleThreat=!1;theater.addEventListener("click",function(){if(toggleThreat=!toggleThreat)return video_theater.appendChild(default_palyer.lastElementChild),void(default_palyer.innerHTML="");default_palyer.appendChild(video_theater.lastElementChild),video_theater.innerHTML=""}),fullscreen_icon.addEventListener("click",function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():mayPlayerWrapper.requestFullscreen()});const pic=controls.querySelector(".pic");"pictureInPictureEnabled"in document?pic.addEventListener("click",function(){media.requestPictureInPicture().catch(e=>console.log(e))}):pic.style.display="none",document.querySelector("body").addEventListener("click",function(){"flex"===speed.style.display&&(speed.style.display="none")});const speed=controls.querySelector(".speed");setting.addEventListener("click",function(e){"flex"===speed.style.display?speed.style.display="none":(speed.style.display="flex",e.stopPropagation())}),$(".speed_rate_item").click(function(e){$(".speed_rate_item").removeClass("active"),$(this).addClass("active"),media.playbackRate=+e.target.textContent.split("X")[0]}),media.addEventListener("mouseenter",function(){speed.style.display="none"});const gettime=function(e){let t=Math.floor(e/60),i=Math.floor(e-60*t);return t<10&&(t="0"+t),i<10&&(i="0"+i),t+":"+i};function AdSlot(e,t,i,n){this.name=e,this.type=t,this.time=i,this.zone=n,this.source="",this.seen=!1,this.playOnce=!0}function convertTimeFormat(e){return 3600*e.substr(0,2)+60*e.substr(2,2)+1*e.substr(4,2)}function constructAdList(e){if(e.getElementsByTagName("Linear")[0]){const t=e.getElementsByTagName("Linear")[0].getAttribute("skipoffset").split(":");skipAdsTime=3600*+t[0]+60*+t[1]+ +t[2]}if(e.getElementsByTagName("TrackingEvents")[0]){const t=e.getElementsByTagName("TrackingEvents")[0].children;Array.from(t).forEach(e=>{switch(e.getAttribute("event")){case"start":window.startURL=e.textContent.trim();break;case"progress":window.progressURL=e.textContent.trim();break;case"firstQuartile":window.firstQuartileURL=e.textContent.trim();break;case"midpoint":window.midpointURL=e.textContent.trim();break;case"thirdQuartile":window.thirdQuartileURL=e.textContent.trim();break;case"complete":window.completeURL=e.textContent.trim()}})}if(e.getElementsByTagName("MediaFiles")[0]){const t=e.getElementsByTagName("MediaFiles")[0].children;for(v in AdList){const e=Array.from(t).filter(e=>"video/mp4"===e.getAttribute("type"));AdList[v].source=e[0].textContent.trim()}}if(e.getElementsByTagName("VideoClicks")[0]){const t=e.getElementsByTagName("VideoClicks")[0].children,i=Array.from(t).filter(e=>e.getElementsByTagName("ClickThrough"));adsClickLink=i&&i.length>0?i[0].textContent.trim():null}else adsClickLink=null;videoTag.addEventListener("timeupdate",showAdSlots,!1)}function enforcePrecision(e,t){return+e.toFixed(t)}function seekToOriginalPoint(){videoTag.removeEventListener("canplaythrough",seekToOriginalPoint,!1),videoTag.removeEventListener("load",seekToOriginalPoint,!1),videoTag.currentTime=enforcePrecision(tempTime,1),videoTag.play(),videoTag.addEventListener("timeupdate",showAdSlots,!1)}function resumePlayBackAfterSlotShow(){videoTag.removeEventListener("ended",resumePlayBackAfterSlotShow,!1),videoTag.removeEventListener("timeupdate",listenAdsPartTime,!1),startFired=!1,proggressFired=!1,firstQuartileFired=!1,midpointFired=!1,thirdQuartileFired=!1,completeFired=!1,$(".skipBtn").hide(),videoTag.src=videoTag.mainTrack,videoTag.play(),4!==videoTag.readyState&&(videoTag.addEventListener("canplaythrough",seekToOriginalPoint,!1),videoTag.addEventListener("load",seekToOriginalPoint,!1),videoTag.pause())}function callAdsTrackApi(e){return new Promise((t,i)=>{let n=new XMLHttpRequest;n.open("GET",e,!0),n.send(null),n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(n=null,t())}})}function countdown(){}function playAdsInCorrectWay(){videoTag.removeEventListener("canplaythrough",playAdsInCorrectWay,!1),videoTag.play(),$(".skipBtn").show().addClass("disabled"),$(".skipBtn").html(countDown),videoTag.onplaying=countDownInterval=setInterval(function(){$(".skipBtn").text(countDown-1),countDown<1&&($(".skipBtn").text("skip ads"),clearInterval(countDownInterval)),countDown--},1e3)}function showSlot(e){videoTag.src=e.source,videoTag.addEventListener("canplaythrough",playAdsInCorrectWay,!1),videoTag.addEventListener("timeupdate",listenAdsPartTime,!1);var t=setInterval(function(){$("#player").get(0).currentTime>skipAdsTime+1&&($(".skipBtn").removeClass("disabled"),clearInterval(t))},1e3);videoTag.addEventListener("ended",resumePlayBackAfterSlotShow,!1)}function slotForCurrentTime(e){for(v in AdList)if(!AdList[v].seen&&AdList[v].source&&AdList[v].time==e)return AdList[v];return null}function showAdSlots(){var e=slotForCurrentTime(Math.floor(videoTag.currentTime));e&&(e.seen=!0,tempTime=videoTag.currentTime,videoTag.removeEventListener("timeupdate",showAdSlots,!1),showSlot(e))}AdsRequest=function(e){var t=0,i=0,n=0,a=0;for(v in e.schedule)switch(e.schedule[v].position){case"pre-roll":var s=new AdSlot("pre-roll-"+t,"pre-roll",0,e.schedule[v].zone);t++,AdList.push(s);break;case"mid-roll":s=new AdSlot("mid-roll-"+i,"mid-roll",convertTimeFormat(e.schedule[v].startTime),e.schedule[v].zone);i++,AdList.push(s);break;case"post-roll":s=new AdSlot("post-roll-"+n,"post-roll",0,e.schedule[v].zone);n++,AdList.push(s);break;case"auto:bottom":s=new AdSlot("auto:bottom-"+a,"auto:bottom",convertTimeFormat(e.schedule[v].startTime),e.schedule[v].zone);a++,AdList.push(s)}videoTag.addEventListener("canplay",setPostRollTime,!1),videoTag.load()},parseAdsParameters=function(input){return!/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(input.replace(/"(\\.|[^"\\])*"/g,""))&&eval("("+input+")")},listenAdsPartTime=function(){let e;const t=Math.floor(videoTag.duration),i=window.skipAdsTime,n=Math.ceil(t/4),a=2*n,s=3*n,r=t;switch(Math.floor(videoTag.currentTime)){case 0:e={url:window.startURL,event:"start"};break;case i:e={url:window.progressURL,event:"progress"};break;case n:e={url:window.firstQuartileURL,event:"firstQuartile"};break;case a:e={url:window.midpointURL,event:"midpoint"};break;case s:e={url:window.thirdQuartileURL,event:"thirdQuartile"};break;case r:e={url:window.completeURL,event:"complete"}}e&&"start"===e.event&&!1===startFired&&(startFired=!0,callAdsTrackApi(e.url).then(()=>{})),e&&"progress"===e.event&&!1===proggressFired&&(proggressFired=!0,callAdsTrackApi(e.url).then(()=>{})),e&&"firstQuartile"===e.event&&!1===firstQuartileFired&&(firstQuartileFired=!0,callAdsTrackApi(e.url).then(()=>{})),e&&"midpoint"===e.event&&!1===midpointFired&&(midpointFired=!0,callAdsTrackApi(e.url).then(()=>{})),e&&"thirdQuartile"===e.event&&!1===thirdQuartileFired&&(thirdQuartileFired=!0,callAdsTrackApi(e.url).then(()=>{})),e&&"complete"===e.event&&!1===completeFired&&(completeFired=!0,callAdsTrackApi(e.url).then(()=>{}))};var tempTime=0,skipAdsTime=5,countDownInterval,countDown=5,startFired=!1,proggressFired=!1,firstQuartileFired=!1,midpointFired=!1,thirdQuartileFired=!1,completeFired=!1,adsClickLink,videoTag,AdList=new Array,supposedCurrentTime=0,AdObj;function initAdsFor(e){window.videoTag=document.getElementById(e),videoTag.mainTrack=videoTag.src,videoTag.getAttribute("ads")&&(AdObj=parseAdsParameters(videoTag.getAttribute("ads")),AdsRequest(AdObj),getAdsSource()),videoTag.addEventListener("pause",managePauseVideo,!1),videoTag.addEventListener("ended",manageEndedMainVideo,!1),videoTag.addEventListener("timeupdate",function(){if(videoTag.mainTrack!==videoTag.src){rwd.style.display="none",fwd.style.display="none",setting.style.display="none",input.style.display="none";let e=document.createElement("div");e.classList.add("controls__progressbar-current-ADV"),controls__progressbar.append(e),current_time.textContent=gettime(media.currentTime);let t=media.currentTime/media.duration*100;e.style.background=`linear-gradient(90deg, rgba(0, 206,209, 1) ${t}%, #000000E6 0%)`}videoTag.mainTrack===videoTag.src&&(rwd.style.display="flex",fwd.style.display="flex",floatingVideoActive?(setting.style.display="none",rwd.style.display="none",fwd.style.display="none"):(setting.style.display="flex",rwd.style.display="flex",fwd.style.display="flex"),input.style.display="flex",$(".controls__progressbar-current-ADV").css("display","none"))},!1),videoTag.addEventListener("seeking",function(e){videoTag.mainTrack===videoTag.src&&AdObj&&AdObj.servers[0].apiAddress&&AdList.every(e=>!e.seen)&&(videoTag.currentTime=0)},!1),videoTag.addEventListener("seeked",function(e){videoTag.mainTrack,videoTag.src},!1)}function setPostRollTime(){for(v in videoTag.removeEventListener("canplay",setPostRollTime,!1),AdList)"post-roll"==AdList[v].type&&(AdList[v].time=Math.floor(videoTag.duration))}getAdsSource=function(){if(videoTag.removeEventListener("play",getAdsSource,!1),videoTag.removeEventListener("timeupdate",getAdsSource,!1),AdObj&&AdObj.servers[0].apiAddress){var e=new XMLHttpRequest;e.open("GET",AdObj.servers[0].apiAddress,!0),e.send(null),e.onreadystatechange=function(){if(4==e.readyState){if(200==e.status){var t=e.responseXML;t&&constructAdList(t)}e=null}}}},managePauseVideo=function(){videoTag.mainTrack!==videoTag.src&&(videoTag.currentTime,videoTag.duration,clearInterval(countDownInterval),countDown=$(".skipBtn").text(),"skip ads"!==$(".skipBtn").text()&&videoTag.addEventListener("timeupdate",resumeAdsVideo,!1))},resumeAdsVideo=function(){if(videoTag.removeEventListener("timeupdate",resumeAdsVideo,!1),"skip ads"===countDown)return!1;$(".skipBtn").text(countDown),countDownInterval=setInterval(function(){$(".skipBtn").text(countDown-1),countDown<1&&($(".skipBtn").text("skip ads"),clearInterval(countDownInterval)),countDown--},1e3)},manageSeekingVideo=function(e){if(videoTag.mainTrack!==videoTag.src){e.preventDefault(),videoTag.removeEventListener("seeking",manageSeekingVideo,!1);const t=videoTag.currentTime;videoTag.currentTime=t}},manageEndedMainVideo=function(){supposedCurrentTime=0,videoTag.mainTrack===videoTag.src&&(AdList.forEach(e=>e.seen=!1),countDown=5,play.style.display="flex",pause.style.display="none",videoTag.addEventListener("timeupdate",getAdsSource,!1),animatedBtn.classList.toggle("animations"))},$(document).on("click",".skipBtn",function(e){$("#player").get(0).currentTime<skipAdsTime||resumePlayBackAfterSlotShow()});var floatingVideoActive=!1,pipActive=!1,$window=$(window),$videoWrap=$(".videoContainer"),$video=$(".video"),videoHeight=$video.outerHeight(),windowScrollTop,videoBottom;$window.on("scroll",function(){if(windowScrollTop=$window.scrollTop(),videoBottom=videoHeight+$videoWrap.offset().top,pipActive)return!1;windowScrollTop>videoBottom?($videoWrap.height(videoHeight),$video.addClass("stuck"),videoTag.mainTrack!==videoTag.src&&(rwd.style.display="none",fwd.style.display="none"),video_time.style.display="none",current_time.style.display="none",time_divider.style.display="none",theater.style.display="none",setting.style.display="none",animatedBtn.style.width="40px",animatedBtn.style.height="40px",floatingVideoActive=!0):($videoWrap.height("auto"),$video.removeClass("stuck"),videoTag.mainTrack!==videoTag.src?(rwd.style.display="none",fwd.style.display="none"):(rwd.style.display="flex",fwd.style.display="flex"),video_time.style.display="inline-flex",current_time.style.display="inline-flex",time_divider.style.display="inline-flex",theater.style.display="flex",setting.style.display="flex",animatedBtn.style.width="80px",animatedBtn.style.height="80px",floatingVideoActive=!1)}),media.addEventListener("enterpictureinpicture",function(){pipActive=!0,$video.hasClass("stuck")&&($videoWrap.height("auto"),$video.removeClass("stuck"))}),media.addEventListener("leavepictureinpicture",function(){pipActive=!1,windowScrollTop>videoBottom?($videoWrap.height(videoHeight),$video.addClass("stuck")):($videoWrap.height("auto"),$video.removeClass("stuck"))});
